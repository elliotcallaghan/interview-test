    var timer,
        seconds = 0;
    $("#startTest").on("click", function() {

        if ($("#testName").val()) {
            $(this).off();

            $(".interview-questions").addClass("loading");

            $.ajax({
                type: "POST",
                url: "../wp-admin/admin-ajax.php",
                dataType: "json",
                data: {
                    action: "ec_start_test",
                }
            }).always(function () {
                $(".interview-questions").removeClass("loading");
            }).done(function (data) {
                var questions = data['questions'],
                    categories = data['categories'],
                    html = "<ul>",
                    qNum = 1,
                    navNum = 1,
                    total = categories[questions[0][2]];

                $(".interview-questions").removeClass("loading");
                $("#startTest, .test-error").detach();
                $(".text, #testName").hide();
                $(".nav-buttons").show();

                questions.forEach(function(element, index) {
                    if (element[3] === 1) {
                        var type = "radio";
                    } else {
                        var type = "checkbox";
                    }
                    html += "<div id='q" + element[0] + "' class='question'><h2>" + element[2] + "</h2><table class='nav-bar'>";
                    var i = 1,
                        navNum = total - categories[element[2]];
                    for (i; i <= categories[element[2]]; i++) {
                        navNum++;
                        if (index === total) {
                            total += categories[element[2]];
                            navNum = total - categories[element[2]] + 1;
                        }
                        html += "<td class='nav-button' id='n" + navNum + "'>" + navNum + "</td>";
                    }
                    html +=
                        "</table><li>" + element[1] + "</li>" +
                        "<input checked type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o1' value='" + element[4] + "'><label for='q" + qNum + "o1'>" + element[4] + "</label><br>" +
                        "<input type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o2' value='" + element[5] + "'><label for='q" + qNum + "o2'>" + element[5] + "</label>";
                    if (element[6] != null) {
                        html += "<br><input type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o3' value='" + element[6] + "'><label for='q" + qNum + "o3'>" + element[6] + "</label>";
                    }
                    if (element[7] != null) {
                        html += "<br><input type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o4' value='" + element[7] + "'><label for='q" + qNum + "o4'>" + element[7] + "</label>";
                    }
                    if (element[8] != null) {
                        html += "<br><input type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o5' value='" + element[8] + "'><label for='q" + qNum + "o5'>" + element[8] + "</label>";
                    }
                    if (element[9] != null) {
                        html += "<br><input type='" + type + "' name='q" + qNum + "' id='q" + qNum + "o6' value='" + element[9] + "'><label for='q" + qNum + "o6'>" + element[9] + "</label>";
                    }
                    html += "</div>";
                    qNum++;
                })
                html += "</ul>";
                $(".interview-questions").append(html);

                $("input[type='checkbox']").on("change", limitChecks);

                qNum = 1;
                questions.forEach(function(element) {
                    if ($("input[type='checkbox'][name='q" + qNum + "']")) {
                        $("input[type='checkbox'][name='q" + qNum + "']").data("numOfCorAnswers", element[3]);
                    }
                    qNum++;
                });

                $(".question:first-of-type").show();
                $(".nav-button").on("click", function() {
                    var id = $(this).attr("id");
                    $(".question").hide();
                    $("#q" + id.substring(1)).show();
                    checkButtons();
                });
                checkButtons();
                testTimer();
            }).fail(function () {
                console.log("Ajax failed");
            })
        } else {
            $(".test-error").html("Please enter a name");
        }
    })

    function limitChecks(event) {
        var name = $(this).attr("name");
        if ($("input[name='" + name + "']:checked").length >= $(this).data("numOfCorAnswers")) {
            $("input[name='" + name + "']").attr("disabled", "disabled");
            $("input[name='" + name + "']:checked").removeAttr("disabled");
        } else {
            $("input[name='" + name + "']").removeAttr("disabled");
        }
    }

    function checkButtons() {
        if ($(".question:first-of-type").is(":visible")) {
            $("#testPrev").addClass("button-inactive");
        } else {
            $("#testPrev").removeClass("button-inactive");
        }
        if ($(".question:last-of-type").is(":visible")) {
            $("#testNext").hide();
            $("#testSubmit").show();
        } else {
            $("#testNext").show();
            $("#testSubmit").hide();
        }
        $(".nav-button").css("background", "#67abff");
        var activeNav = ($(".question:visible").attr("id")).substring(1);
        $(".nav-bar #n" + activeNav).css("background", "darkgray");
    }

    function testTimer() {
        var interval = 1000,
            expected = Date.now() + interval;
        timer = setTimeout(step, interval);
        function step() {
            var dt = Date.now() - expected;
            seconds++;
            /*if (seconds === 60) {
                minutes++;
                seconds = 0;
            }
            if (minutes === 60) {
                hours++;
                minutes = 0;
            }
            if (seconds < 10) {
                $(".timer").html(hours + ":" + minutes + ":0" + seconds++);
            } else {
                $(".timer").html(hours + ":" + minutes + ":" + seconds++);
            }*/
            expected += interval;
            timer = setTimeout(step, Math.max(0, interval - dt));
        }
    }

    $("#testNext").on("click", function() {
        if ($(".question:last-of-type").is(":visible")) {
            return false;
        } else {
            $(".question:visible").hide().next().show();
            $("#testPrev").show();
            checkButtons();
        }
    })

    $("#testPrev").on("click", function() {
        if ($(".question:first-of-type").is(":visible")) {
            return false;
        } else {
            $(".question:visible").hide().prev().show();
            checkButtons();
        }
    })

    $("#testSubmit").on("click", function() {
        var responses = [],
            qNum = 1,
            embedded = "",
            name = $("#testName").val();

        clearTimeout(timer);

        $(".question").each(function() {
            $("input[name='q" + qNum + "']:checked").each(function() {
                if ($("input[name='q" + qNum + "']:checked").length === 1) {
                    if (embedded !== "") {
                        responses.push(embedded);
                        embedded = "";
                    }
                    responses.push($(this).val());
                } else {
                    embedded += $(this).val() + ";";
                }
            })
            qNum++;
        })

        $(".interview-questions").empty();
        $(".nav-buttons, #testName").detach();
        $(".interview-questions").addClass("loading");

        $.ajax({
            type: "POST",
            url: "../wp-admin/admin-ajax.php",
            dataType: "json",
            data: {
                action: "ec_submit_test",
                responses: responses,
                name: name,
                seconds: seconds
            }
        }).always(function () {
            $(".interview-questions").removeClass("loading");
        }).done(function (data) {
            $(".question").hide();
            $(".text").html("Your test has been submitted and you got " + data).show();
            console.log(data);
        }).fail(function (data) {
            console.log("Ajax failed");
            console.log(data);
        })
    })
